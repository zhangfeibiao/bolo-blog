function Emiya(){this.listen()}function initPageShare(){var t=$(".J_share"),e=$(".J_share_wechat"),a=e.data("url"),o=e.data("avatar"),n=encodeURIComponent(e.data("title")+" - "+e.data("blogtitle")),i=encodeURIComponent(a),r={};r.weibo="http://v.t.sina.com.cn/share/share.php?title="+n+"&url="+i+"&pic="+o,r.qzone="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+i+"&sharesource=qzone&title="+n+"&pics="+o,r.twitter="https://twitter.com/intent/tweet?status="+n+" "+i,t.on("click",(function(){var t=$(this).data("type");if(t)return"wechat"===t?(0===e.find("canvas").length?$.ajax({method:"GET",url:Label.staticServePath+"/js/lib/jquery.qrcode.min.js",dataType:"script",cache:!0,success:function(){e.qrcode({width:128,height:128,text:a})}}):e.find("canvas").slideToggle(),!1):void window.open(r[t],"_blank","top=100,left=200,width=648,height=618")}))}function initContents(){var t={h1:5,h2:4,h3:3,h4:2,h5:1},e=getArticleTitles();if(0!==e.length){var a,o,n='<ul class="article__contents">';e.each((function(i,r){var s=t[r.tagName.toLowerCase()],c=e.eq(i).text(),l='<li><a href="javascript:void(0);" data-target="#'+e.eq(i).attr("id")+'">'+c+"</a></li>";s&&(o?s===a?n+=l:s<a?n+=Array(a-s).fill("<ul>").join("")+l:s>a&&(n+=Array(s-a).fill("</ul>").join("")+l):(n+=l,o=s),a=s)})),n+=Array(o-a+1).fill("</ul>").join(""),$(".J_article__contents--container").append(n)}else $(".J_article__contents").hide()}var getArticleTitles=function(){var t=null;return function(){if(null!==t)return t;var e=$("[id^=b3_solo_h]");return t=e}}();function ScrollManagerCreator(t){var e,a=t,o=$(".J_navbar"),n=$(".toTop"),i=$(".J_article__contents"),r=$(".J_article__content");function s(t){var e=o.height()+1;t>e?o.addClass("is-fixed").css("top",-1*e):t<=0&&o.removeClass("is-fixed").css("top",0),o.hasClass("is-fixed")&&(t>a?o.removeClass("show"):o.addClass("show"))}function c(t){t>100?n.fadeIn():n.fadeOut()}function l(t){if(!(i.length<=0)){var e=i.prev(),a=i.height(),n=e.offset().top+e.height(),s=o.height()+1,c=r.offset().top+r.height()-a+s;a+s>$(window).height()||t<=n-s?i.css("position","static"):t>n-s&&t<c-s?i.css({position:"fixed",top:s}):i.css({position:"absolute",top:c})}}function h(t){clearTimeout(e),e=setTimeout((function(){for(var e,a=o.height()+1,n=$(".J_article__contents--container a"),i=0;i<n.length;i++){var r=n.eq(i).attr("data-target");t+a>$(r).offset().top&&(e=i)}n.removeClass("active"),n.eq(e).addClass("active")}),50)}return s(a),c(a),l(a),h(a),function(t){s(t),c(t),l(t),h(t),a=t}}function scrollTo(t){$("html ,body").animate({scrollTop:t},300)}var scrollManager=ScrollManagerCreator($(window).scrollTop());Emiya.prototype.listen=function(){$(".J_navbar_toggle").on("click",(function(){var t="."+$(this).attr("data-for");$(t).hasClass("show")?$(t).removeClass("show"):$(t).addClass("show")})),$(".J_replyName").on("click",(function(){var t=$(this).attr("data-originalId");$("#"+t)[0].scrollIntoViewIfNeeded(!0),$("#"+t).addClass("blink"),setTimeout((function(){$("#"+t).removeClass("blink")}),3e3)})),$(".J_backToTop").on("click",(function(t){scrollTo(0),t.preventDefault()})),$(window).on("scroll",(function(){var t=$(window).scrollTop();scrollManager(t)})),$("body").on("click",".J_article__contents--container a",(function(){var t=$(this).attr("data-target");scrollTo($(t).offset().top-$(".J_navbar").height()+1)})),$("body").on("touchstart",(function(){}))},Emiya.prototype.initArticle=function(){initPageShare();try{initContents()}catch(t){console.error(t)}},window.Skin=new Emiya;